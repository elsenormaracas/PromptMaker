<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PR0MPT_MASTER</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’¾</text></svg>">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap');

        :root {
            --p-color: #42ff71;
            --p-glow: 0 0 6px rgba(66, 255, 113, 0.6), 0 0 2px rgba(66, 255, 113, 0.8);
            --bg-faded: #121412; 
        }
        body.theme-amber { 
            --p-color: #ffb000; 
            --p-glow: 0 0 6px rgba(255, 176, 0, 0.6), 0 0 2px rgba(255, 176, 0, 0.8);
            --bg-faded: #14110b; 
        }
        body.theme-white { 
            --p-color: #e0e0e0; 
            --p-glow: 0 0 4px rgba(255, 255, 255, 0.4);
            --bg-faded: #161616; 
        }
        body.theme-red { 
            --p-color: #ff3e3e; 
            --p-glow: 0 0 6px rgba(255, 62, 62, 0.6), 0 0 2px rgba(255, 62, 62, 0.8);
            --bg-faded: #140b0b; 
        }

        body {
            background-color: #000; color: var(--p-color); font-family: 'Fira Code', monospace;
            margin: 0; height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden;
            text-shadow: var(--p-glow);
        }

        .crt-monitor {
            width: 100vw; height: 100vh; background: var(--bg-faded); position: relative;
            overflow: hidden; display: flex; flex-direction: column; padding: 20px; box-sizing: border-box;
        }

        @media (min-width: 768px) {
            .crt-monitor { width: 95vw; height: 90vh; max-width: 900px; border: 15px solid #1a1a1a; border-radius: 40px; padding: 40px; }
        }

        .crt-monitor::before {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.2) 50%);
            background-size: 100% 4px; pointer-events: none; z-index: 21;
        }

        .noise-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyBAMAAADsEZWCAAAAGFBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADeST97AAAAB3RSTlMAVVDu/v4AfZ3OAAAARElEQVQ4y2NgQAX8DIxgIAnGZ2AEAzEwHh0tGEiC8ZlQMBCPjhYMJMH4TCgYiEdHCwaSYHwmFAzEo6MFA0kwPhMKBuIRAFidGf9p99vjAAAAAElFTkSuQmCC");
            opacity: 0.1; pointer-events: none; z-index: 25; animation: noise 0.2s infinite;
        }

        @keyframes noise { 0% { transform: translate(0,0); } 50% { transform: translate(-0.5%, 0.5%); } 100% { transform: translate(0,0); } }

        .view-content { position: relative; z-index: 30; display: none; flex-direction: column; height: 100%; animation: flicker 0.2s infinite; }
        @keyframes flicker { 0% { opacity: 0.99; } 50% { opacity: 1; } 100% { opacity: 0.98; } }
        .view-content.active { display: flex; }

        header { border-bottom: 1px solid var(--p-color); margin-bottom: 15px; font-size: 0.7rem; padding-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }

        .prompt-display { 
            font-size: 1rem; border: 1px solid var(--p-color); padding: 15px; margin: 10px 0; 
            background: rgba(255, 255, 255, 0.02);
        }

        textarea {
            flex-grow: 1; background: rgba(0,0,0,0.2); color: var(--p-color); border: 1px solid var(--p-color);
            padding: 15px; font-family: 'Fira Code', monospace; font-size: 1rem; resize: none; outline: none;
            text-shadow: var(--p-glow); margin-bottom: 15px;
        }

        .btn-group { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            width: 100%;
        }
        
        button {
            background: var(--p-color); color: #000; border: none; padding: 12px 5px;
            font-family: 'Fira Code', monospace; font-weight: bold; cursor: pointer;
            text-transform: uppercase; font-size: 0.7rem;
            white-space: nowrap;
            box-shadow: 0 0 8px var(--p-color); transition: 0.2s;
            overflow: hidden; text-overflow: ellipsis;
        }
        button.secondary { background: transparent; color: var(--p-color); border: 1px solid var(--p-color); box-shadow: none; }
        button.danger { background: transparent; color: #ff4757; border: 1px solid #ff4757; text-shadow: 0 0 5px #ff4757; box-shadow: none; }
        button:hover { filter: brightness(1.2); }

        .archive-item { border: 1px solid var(--p-color); margin-bottom: 8px; cursor: pointer; }
        .archive-header { padding: 10px; display: flex; flex-direction: column; gap: 4px; }
        .log-date { font-size: 0.6rem; opacity: 0.7; }
        .log-prompt { font-size: 0.8rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .archive-body { padding: 15px; display: none; font-size: 0.85rem; border-top: 1px dashed var(--p-color); background: rgba(0,0,0,0.4); }
        .archive-item.open .archive-body { display: block; }

        .timer { font-size: 2.2rem; text-align: center; margin-bottom: 10px; font-weight: bold; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--p-color); }
    </style>
</head>
<body>

<div class="crt-monitor">
    <div class="noise-overlay"></div>
    
    <header id="main-header">
        <div>[ PR0MPT_MASTER : 5000 ]</div>
        <button class="secondary" onclick="cycleTheme()" style="padding: 4px 8px; font-size: 0.6rem;">[ C0L0R_CHG ]</button>
    </header>

    <div id="view-home" class="view-content active">
        <div id="prompt-text" class="prompt-display">> SYSTEM_READY. EN ATTENTE...</div>
        <div class="btn-group">
            <button onclick="generatePrompt()">[ N0UVEAU_DEFI ]</button>
            <button onclick="startSession()" id="start-btn" style="display:none;">[ DEMARRER ]</button>
        </div>
    </div>

    <div id="view-writing" class="view-content">
        <div id="writing-prompt-large" class="prompt-display" style="font-size: 0.9rem; border-bottom: 3px double var(--p-color); margin-top:0;"></div>
        <div class="timer" id="timer-display">10:00</div>
        <textarea id="story-input" spellcheck="false" oninput="countWords()"></textarea>
        <div class="btn-group">
            <button onclick="cancelSession()" class="danger">[ ANNULER ]</button>
            <button onclick="finishEarly()">[ SAUVER ]</button>
        </div>
        <div style="font-size:0.7rem; margin-top: 10px; text-align: right; opacity: 0.7;">
            COMPTE: <span id="word-count">0</span> MOTS
        </div>
    </div>

    <div id="view-history" class="view-content">
        <h2 style="font-size: 1rem; display: flex; justify-content: space-between; margin: 0 0 10px 0;"> 
            <span>> ARCHIVES</span>
            <button class="danger" onclick="clearArchives()" style="flex:none; padding: 4px 8px; font-size: 0.6rem;">[ PURGE ]</button>
        </h2>
        <div id="history-list" style="overflow-y: auto; flex-grow: 1;"></div>
        <div style="margin-top: 15px;">
            <button onclick="showView('view-home')" style="width:100%;">[ RETURN_TO_ROOT ]</button>
        </div>
    </div>

    <footer id="main-footer" style="margin-top: auto; padding-top: 15px;">
        <button onclick="showHistory()" class="secondary" style="width:100%; padding: 10px; font-size: 0.7rem;">./list_archives</button>
    </footer>
</div>
<script src="prompts.js"></script>
<script>
    
    let currentPrompt = null; let timerInterval = null; let timeLeft = 600; let currentTheme = 0; 

    function cycleTheme() {
        const body = document.body;
        currentTheme = (currentTheme + 1) % 4; // Mise Ã  jour pour 4 thÃ¨mes
        body.classList.remove('theme-amber', 'theme-white', 'theme-red');
        if (currentTheme === 1) body.classList.add('theme-amber');
        if (currentTheme === 2) body.classList.add('theme-white');
        if (currentTheme === 3) body.classList.add('theme-red');
    }

    function showView(viewId) {
        document.querySelectorAll('.view-content').forEach(v => v.classList.remove('active'));
        document.getElementById(viewId).classList.add('active');
        const isWriting = (viewId === 'view-writing');
        document.getElementById('main-header').style.display = isWriting ? 'none' : 'flex';
        document.getElementById('main-footer').style.display = isWriting ? 'none' : 'block';
    }

    function generatePrompt() {
        const randomIndex = Math.floor(Math.random() * promptsBase.length);
        currentPrompt = promptsBase[randomIndex];
        document.getElementById('prompt-text').innerText = `> ${currentPrompt.content}`;
        document.getElementById('start-btn').style.display = 'block';
    }

    function startSession() {
        showView('view-writing');
        document.getElementById('writing-prompt-large').innerText = `> ${currentPrompt.content}`;
        document.getElementById('story-input').value = "";
        document.getElementById('story-input').focus();
        startTimer();
    }

    function cancelSession() {
        if(confirm("ABORT?")) { clearInterval(timerInterval); showView('view-home'); }
    }

    function countWords() {
        const text = document.getElementById('story-input').value.trim();
        document.getElementById('word-count').innerText = text ? text.split(/\s+/).length : 0;
    }

    function startTimer() {
        timeLeft = 600; updateTimerDisplay();
        timerInterval = setInterval(() => {
            timeLeft--; updateTimerDisplay();
            if (timeLeft <= 0) saveStory();
        }, 1000);
    }

    function updateTimerDisplay() {
        const mins = Math.floor(timeLeft / 60); const secs = timeLeft % 60;
        document.getElementById('timer-display').innerText = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
    }

    function finishEarly() { if(confirm("ENREGISTRER?")) saveStory(); }

    function saveStory() {
        clearInterval(timerInterval);
        const text = document.getElementById('story-input').value;
        if(text.length < 5) return showView('view-home');
        const now = new Date();
        const timestamp = `${now.toLocaleDateString()} @ ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
        const history = JSON.parse(localStorage.getItem('pRetroFinal_v11') || '[]');
        history.unshift({ timeLabel: timestamp, prompt: currentPrompt.content, text: text });
        localStorage.setItem('pRetroFinal_v11', JSON.stringify(history));
        showHistory();
    }

    function showHistory() {
        showView('view-history');
        const list = document.getElementById('history-list');
        const history = JSON.parse(localStorage.getItem('pRetroFinal_v11') || '[]');
        list.innerHTML = history.length ? history.map((item, idx) => `
            <div class="archive-item" onclick="toggleArchive(this)">
                <div class="archive-header">
                    <span class="log-date">[ENREGSTR: ${item.timeLabel}]</span>
                    <span class="log-prompt">> ${item.prompt}</span>
                </div>
                <div class="archive-body" onclick="event.stopPropagation()">
                    <div style="margin-bottom:15px; line-height:1.6;">${item.text.replace(/\n/g, '<br>')}</div>
                    <button class="secondary" style="width:100%; font-size:0.6rem;" onclick="copyText(this)">[ C0PIER ]</button>
                </div>
            </div>
        `).join('') : "> ARCHIVES_INTROUVABLES";
    }

    function toggleArchive(el) { el.classList.toggle('open'); }
    function copyText(btn) {
        const text = btn.previousElementSibling.innerText;
        navigator.clipboard.writeText(text).then(() => {
            const original = btn.innerText; btn.innerText = "[ C0PIÃ‰! ]";
            setTimeout(() => btn.innerText = original, 2000);
        });
    }

    function clearArchives() {
        if(confirm("RESET?")) { localStorage.removeItem('pRetroFinal_v11'); showHistory(); }
    }
</script>
</body>
</html>
